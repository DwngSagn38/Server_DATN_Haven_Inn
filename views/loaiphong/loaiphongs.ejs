<%- include('../main/header.ejs') %>

    <div class="container">
        <h1>Danh sách Loại Phòng</h1>

        <% if (message) { %>
            <div class="alert alert-warning" id="successMessage">
                <%= message %>
            </div>
            <% } %>

                <!-- Nút thêm loại phòng -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#serviceModal"
                    id="addServiceBtn">
                    Thêm Loại phòng
                </button>

                <table id="loaiphongTable" class="table table-striped table-bordered table-hover mt-3">
                    <thead class="thead-dark">
                        <tr>
                            <th class="text-center" style="width: 200px">Tên Loại phòng</th>
                            <th class="text-center" style="width: 120px">Kiểu giường</th>
                            <th class="text-center" style="width: 120px">Sức chứa</th>
                            <th class="text-center" style="width: 120px">Diện tích</th>
                            <th class="text-center" style="width: 120px">Giá tiền</th>
                            <th class="text-center" style="width: 120px">Tổng phòng</th>
                            <th class="text-center" style="width: 120px">Hình ảnh</th>
                            <th class="text-center" style="width: 120px">Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% loaiphongs.forEach(loaiphong=> { %>
                            <tr>
                                <td>
                                    <%= loaiphong.tenLoaiPhong %>
                                </td>
                                <td>
                                    <%= loaiphong.giuong %>
                                </td>
                                <td>
                                    <%= loaiphong.soLuongKhach %>
                                </td>
                                <td>
                                    <%= loaiphong.dienTich %>
                                </td>
                                <td>
                                    <%= loaiphong.giaTien %>
                                </td>
                                <td>
                                    <%= loaiphong.totalPhong %>
                                </td>
                                <td>
                                    <% if (loaiphong.hinhAnh && loaiphong.hinhAnh.length> 0) { %>
                                        <img src="<%= loaiphong.hinhAnh[0] %>" class="img-fluid"
                                            style="max-width: 120px; max-height: 120px;">
                                        <% } else { %>
                                            Không có ảnh
                                            <% } %>
                                </td>
                                <td class="text-center">
                                    <!-- Nút Xem Chi Tiết -->
                                    <a class="" data-id="<%= loaiphong._id %>"
                                        data-ten="<%= loaiphong.tenLoaiPhong %>" data-giuong="<%= loaiphong.giuong %>"
                                        data-soluongkhach="<%= loaiphong.soLuongKhach %>"
                                        data-dientich="<%= loaiphong.dienTich %>"
                                        data-giatien="<%= loaiphong.giaTien %>" data-mota="<%= loaiphong.moTa %>"
                                        data-hinhanh='<%= JSON.stringify(loaiphong.hinhAnh) %>' data-bs-toggle="modal"
                                        data-bs-target="#detailsModal">
                                        <img src="/public/images/eye.png" alt="Chi tiết" style="width: 24px; height: 24px;">
                                    </a>
                                    <!-- Nút Sửa -->
                                    <a class="btn-edit-loaiphong" data-id="<%= loaiphong._id %>"
                                        data-ten="<%= loaiphong.tenLoaiPhong %>" data-giuong="<%= loaiphong.giuong %>"
                                        data-soluongkhach="<%= loaiphong.soLuongKhach %>"
                                        data-dientich="<%= loaiphong.dienTich %>"
                                        data-giatien="<%= loaiphong.giaTien %>" data-mota="<%= loaiphong.moTa %>"
                                        data-hinhanh='<%= JSON.stringify(loaiphong.hinhAnh) %>' data-bs-toggle="modal"
                                        data-bs-target="#serviceModal">
                                        <img src="/public/images/edit.png" alt="Sửa" style="width: 24px; height: 24px;">
                                    </a>


                                    <!-- Nút Xóa -->
                                    <a class="btn-delete-loaiphong" data-id="<%= loaiphong._id %>"
                                        data-ten="<%= loaiphong.tenLoaiPhong %>" data-bs-toggle="modal"
                                        data-bs-target="#confirmDeleteModal">
                                        <img src="/public/images/delete.png" alt="Xóa"
                                            style="width: 24px; height: 24px;">
                                    </a>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
    </div>

    <!-- Modal Xác Nhận Xóa -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Xác nhận xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Bạn có chắc chắn muốn xóa loại phòng <strong id="deleteServiceName"></strong> không?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <form id="confirmDeleteButton" method="POST">
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Thêm/Sửa Loại Phòng -->
    <div class="modal fade" id="serviceModal" tabindex="-1" aria-labelledby="serviceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Form sẽ được thay đổi động khi mở modal -->
                <form id="serviceForm" method="POST" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title" id="serviceModalLabel">Thêm loại phòng mới</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Tên loại phòng -->
                        <div class="mb-3">
                            <label for="tenLoaiPhong" class="form-label">Tên loại phòng</label>
                            <input type="text" class="form-control" id="tenLoaiPhong" name="tenLoaiPhong" required>
                        </div>
                        <!-- Kiểu giường -->
                        <div class="mb-3">
                            <label for="giuong" class="form-label">Kiểu giường</label>
                            <input type="text" class="form-control" id="giuong" name="giuong" required>
                        </div>
                        <!-- Sức chứa -->
                        <div class="mb-3">
                            <label for="soLuongKhach" class="form-label">Sức chứa</label>
                            <input type="number" class="form-control" id="soLuongKhach" name="soLuongKhach" required>
                        </div>
                        <!-- Diện tích -->
                        <div class="mb-3">
                            <label for="dienTich" class="form-label">Diện tích (m²)</label>
                            <input type="number" class="form-control" id="dienTich" name="dienTich" required>
                        </div>
                        <!-- Giá tiền -->
                        <div class="mb-3">
                            <label for="giaTien" class="form-label">Giá tiền (VND)</label>
                            <input type="number" class="form-control" id="giaTien" name="giaTien" required>
                        </div>
                        <!-- Mô tả -->
                        <div class="mb-3">
                            <label for="moTa" class="form-label">Mô tả</label>
                            <textarea class="form-control" id="moTa" name="moTa" rows="4" required></textarea>
                        </div>
                        <!-- Hình ảnh -->
                        <div class="mb-3">
                            <label for="images" class="form-label">Hình ảnh</label>
                            <input type="file" class="form-control" id="images" name="images" accept="image/*" multiple>
                        </div>
                        <!-- Hiển thị ảnh cũ nếu có -->
                        <div id="currentImagePreviewContainer" class="mb-3" style="display: none;">
                            <label for="currentImageLabel" class="form-label">Ảnh hiện tại</label>
                            <div id="currentImagePreview" style="display: flex; gap: 10px;"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-success">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Modal Xem Chi Tiết -->
    <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailsModalLabel">Chi tiết loại phòng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>Tên loại phòng: <span id="detailName"></span></h5>
                    <p><strong>Kiểu giường:</strong> <span id="detailBed"></span></p>
                    <p><strong>Sức chứa:</strong> <span id="detailCapacity"></span></p>
                    <p><strong>Diện tích:</strong> <span id="detailSize"></span> m²</p>
                    <p><strong>Giá tiền:</strong> <span id="detailPrice"></span> VND</p>
                    <p><strong>Mô tả:</strong> <span id="detailDescription"></span></p>

                    <div id="detailImages" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <!-- Dynamic images will be added here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>


    <style>
        .modal-dialog.center {
            position: absolute;
            top: 10%;
            left: 20%;
            transform: translate(-50%, -50%);
            margin: 0;
            /* Xóa margin mặc định */
        }
    </style>


    <%- include('../main/footer.ejs') %>
        <%- include('./loaiphong_js.ejs') %>